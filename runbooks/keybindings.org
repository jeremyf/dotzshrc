Building on [[https://tech.crthaze.com/post/udev-hwdb-keyboard-remapping/][UDev HWDB Keyboard Remapping]]:

#+begin_src shell :dir "/sudo::/"
  apt install evtest --assume-yes --quiet
#+end_src

Run the following command (where event0 is the keyboard):

#+begin_example
sudo udevadm test /sys/class/input/event0 |& grep builtin.command..hwdb | perl -pe "s/^.+'hwdb '(evdev:.+)''/- \1/" | grep '^- evdev'
#+end_example

Then use =sudo evtest /dev/input/event0= to test the key code (e.g. 58 is =KEY_CAPSLOCK=).  And we convert 58 to its hex representation (e.g. =3a=).

The following more durably binds caps to left control.

#+begin_src text :tangle "/sudo::/etc/udev/hwdb.d/60-darter.hwdb"
  evdev:atkbd:dmi:bvncoreboot:*
    KEYBOARD_KEY_3a=rightctrl
#+end_src

With that bound, we need to trigger the key updates:

#+begin_src shell :dir "/sudo::/"
  sudo systemd-hwdb update; sudo udevadm trigger
#+end_src

#+RESULTS:

Last, assuming I’m using the Xorg system, I need to get my Xmodmap setup:

#+begin_src text :tangle ~/.Xmodmap
  !!! NOTE: This file was generated by org-tangle from
  !!!       ~/git/dotzshrc/runbooks/keybindings.org

  ! As a matter of hygiene and cleanliness, clear the modifiers.  We will remap
  ! later.
  clear lock
  clear control
  clear mod1
  clear mod2
  clear mod3
  clear mod4
  clear mod5

  !Bind Fn+Ins to Menu
  keycode 78 = Menu

  ! Keyboard from left to right, with xev key value:
  !
  ! | Ctrl | Fn  | Super | Alt | Space | Alt | Menu | Ctrl |
  ! | 37   | n/a | 133   | 64  | 20    | 108 | 135  | 108  |
  keycode 37 = Hyper_L
  ! keycode 133 = Super_L
  keycode 133 = Super_L
  keycode 64 = Alt_L
  keycode 108 = Alt_R
  keycode 135 = Super_R
  keycode 105 = Control_R

  !Bind caps lock as Control
  keycode 66 = Control_L

  add control = Control_L Control_R
  add mod1 = Alt_L Alt_R Meta_L
  add mod2 = Num_Lock
  add mod3 = Hyper_L
  add mod4 = Super_L Super_R
  ! Treat re-bound insert as mod5 in Terminal
  ! add mod5 = Hyper_R
#+end_src

The following is for my external keyboard.  I’ll likely make more permanent adjustments with hwdb when I next plug this in.

#+RESULTS:
#+begin_example
!!! NOTE: This file was generated by org-tangle from
!!!       ~/git/dotzshrc/runbooks/keybindings.org

! As a matter of hygiene and cleanliness, clear the modifiers.  We will remap
! later.
clear lock
clear control
clear mod1
clear mod2
clear mod3
clear mod4
clear mod5

!Bind Fn+Ins to Menu
keycode 78 = Menu

!Bind left control as Hyper, this key is so hopelessly far away in travel.
keycode 37 = Hyper_L

! Bind left super (e.g. 2nd to left of spacebar)
keycode 133 = Super_L

!Key to left of spacebar
keycode 64 = Alt_L

! Bind key to immediate right of spacebar
keycode 108 = Alt_R

! Bind key second on the right of spacebar
keycode 135 = Super_R

! Bind key third on right of spacebar
keycode 105 = Control_R

!Bind caps lock as Control
keycode 66 = Control_L

!Bind insert as Hyper_R
!keycode 118 = Hyper_R

add control = Control_L Control_R
add mod1 = Alt_L Alt_R Meta_L
add mod2 = Num_Lock
add mod3 = Hyper_L
add mod4 = Super_L Super_R
! Treat re-bound insert as mod5 in Terminal
! add mod5 = Hyper_R
#+end_example

Then update xmodmap:

#+begin_src bash :results scalar replace :exports source :tangle yes
  xmodmap ~/.Xmodmap
#+end_src

I also don’t like Gnome’s default binding of =s-1= through =s-9=:

#+begin_src bash :results scalar replace :exports both :tangle yes
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-1" "@as []"
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-2" "@as []"
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-3" "@as []"
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-4" "@as []"
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-5" "@as []"
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-6" "@as []"
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-7" "@as []"
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-8" "@as []"
  dconf write "/org/gnome/shell/keybindings/open-new-window-application-9" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-1" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-2" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-3" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-4" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-5" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-6" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-7" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-8" "@as []"
  dconf write "/org/gnome/shell/keybindings/switch-to-application-9" "@as []"
#+end_src

#+RESULTS:
