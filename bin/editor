#!/bin/sh

# A shell-script for predictable editing via $HOME/bin/emacsclient

# Determine if we have an existing emacs daemon
ps ax | grep --quiet  emacs | grep --quiet daemon
if [ "$?" != "1" ]; then
    # Launch an emacs daemon
    $HOME/bin/emacs --daemon --debug-init
fi

# Now that we know we have an emacs daemon, determine if we have an
# existing frame.  The goal is to not proliferate frames, but
# instead edit the specified file(s) to an existing frame.
$HOME/bin/emacsclient --no-wait -e "(if (> (length (frame-list)) 1) 't)" | grep -q t

if [ "$?" = "1" ]; then
    if [ "$#" = "0" ]; then # no args no passthrough
        $HOME/bin/emacsclient --create-frame --no-wait --alternate-editor="" --frame-parameters="((fullscreen . maximized)))"
    else # We have args passed, so we must pass them through
        $HOME/bin/emacsclient --create-frame --no-wait --alternate-editor="" --frame-parameters="((fullscreen . maximized)))" "$@"
    fi
else # else a frame does exist, attach to that frame
    if [ "$#" = "0" ]; then # no args no passthrough
        $HOME/bin/emacsclient --no-wait --alternate-editor="" --frame-parameters="((fullscreen . maximized)))"
    else # We have args passed, so we must pass them through
        $HOME/bin/emacsclient --no-wait --alternate-editor="" --frame-parameters="((fullscreen . maximized)))" "$@"
    fi
fi
