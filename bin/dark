#!/usr/bin/env ruby

# This script toggles the Operating System, Terminal, and Emacs
# themes.  It uses the state of the the Operating System to determine
# if the terminal and Emacs should be "dark" or "light".

# First, tell OS-x to toggle dark mode.
system(%(osascript -e'tell application "System Events" to tell appearance preferences to set dark mode to not dark mode'))

# With the dark mode toggled, determine what our display mode is.
# Dark mode returns "Dark", the non-dark mode writes to standard
# error.
appearance = `defaults read -g AppleInterfaceStyle 2>/dev/null`.strip

# There are two valid appearences: "Dark" and "" (eg empty string).
commands = {
  "Dark" => [
    ". $HOME/.config/base16-shell/scripts/base16-google-dark.sh",
    %(editor -e "(modus-vivendi-theme-load)" 1> /dev/null)
  ],
  "" => [
    ". $HOME/.config/base16-shell/scripts/base16-google-light.sh",
    %(editor -e "(modus-operandi-theme-load)" 1> /dev/null)
  ]
}

# Based on the current appearance, set the editor and terminal.
system(Array(commands.fetch(appearance)).join(";"))
