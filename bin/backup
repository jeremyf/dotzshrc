#!/usr/bin/env sh

set -e

journal_dir=/media/jfriesen/Backup
while getopts 'ph' opt; do
    case "$opt" in
    p)
        echo "Using path $2 to write-backup"
        journal_dir=$2
        shift 2
      ;;
    h)
        echo "Usage: $(basename $0) [-p /path/to/backup-media] "
        exit 2
      ;;
    ?)
    echo "Invalid command option.\nUsage $(basename $0) [-p /path/to/backup-media] [-h]"
    exit 2
esac
done

if [ ! -d $journal_dir ]; then
    echo "Missing $journal_dir directory" >&2
    exit 2
fi

if command -v rsync > /dev/null; then
    rsync $HOME $journal_dir \
          --progress --delete-excluded -aiz \
          --exclude=jfriesen/.cache \
          --exclude=jfriesen/go \
          --exclude=jfriesen/.brew \
          --exclude=jfriesen/.emacs.d/straight \
          --exclude=jfriesen/.bundle \
          --exclude=jfriesen/.librewolf \
          --exclude=jfriesen/.mullvad-browser \
          --exclude=jfriesen/.mozilla \
          --exclude=jfriesen/.local \
          --exclude=jfriesen/.rbenv \
          --exclude=*/tmp \
          --exclude=*/._tmp \
          --exclude=*/*.tmp \
          --exclude=*/*.log \
    echo "Wrote backup to $journal_dir"
else
    echo "Missing rsync command" >&2
    exit 1
fi
